#include <Arduino.h>

#if CONFIG_FREERTOS_UNICORE
    static const BaseType_t app_cpu = 0;
#else
    static const BaseType_t app_cpu = 1;
#endif

const char msg[] ="Bu bir mesajdır ve arda tarafından yazılmıştır";

static TaskHandle_t task_1 = NULL;
static TaskHandle_t task_2 = NULL;

void startTask1(void *params){
    int msg_len= strlen(msg);

    while(1){
        Serial.println();
        for (int  i = 0; i < msg_len; i++)
        {
            Serial.print(msg[i]);
        }
        Serial.println();
        vTaskDelay(1000/portTICK_PERIOD_MS);        
    }
}
void startTask2(void *params){
    while(1){
        Serial.print('*');
        vTaskDelay(100/portTICK_PERIOD_MS);
    }
}

void setup(){
    Serial.begin(115200);

    vTaskDelay(2000/portTICK_PERIOD_MS);
    Serial.print(" Setup ve loop taskın çekirdeği :\t");
    Serial.println(xPortGetCoreID());
    Serial.print("Önceliği :\t");
    Serial.print(uxTaskPriorityGet(NULL));

    xTaskCreatePinnedToCore(
        startTask1,
        "task 1",
        1024,
        NULL,
        1,
        &task_1,
        app_cpu
    );

    xTaskCreatePinnedToCore(
        startTask2,
        "task 2",
        1024,
        NULL,
        2,
        &task_2,
        app_cpu
    );
}

void loop(){

    for (int i = 0; i < 3; i++)
    {
        vTaskSuspend(task_2);
        vTaskDelay(2000/portTICK_PERIOD_MS);
        vTaskResume(task_2);
        vTaskDelay(2000/portTICK_PERIOD_MS);
    }

    if(task_1!=NULL){
        vTaskDelete(task_1);
        task_1=NULL;
    }
    

}