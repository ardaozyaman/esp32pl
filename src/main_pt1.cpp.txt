#include <Arduino.h>

#if CONFIG_FREERTOS_UNICORE
static const BaseType_t app_cpu = 0;
#else
static const BaseType_t app_cpu = 1;
#endif

static const int8_t pin_1 = LED_BUILTIN;

int pinDelay_1=100,pinDelay_2 = 300;

void togglePin(void *param)
{
    while (1)
    {
        digitalWrite(pin_1, 1);
        vTaskDelay(pinDelay_1 / portTICK_PERIOD_MS);
        digitalWrite(pin_1, 0);
        vTaskDelay(pinDelay_1 / portTICK_PERIOD_MS);
    }
}

void toggle2Pin(void *param)
{
    while (1)
    {
        digitalWrite(pin_1, 1);
        vTaskDelay(pinDelay_2/ portTICK_PERIOD_MS);
        digitalWrite(pin_1, 0);
        vTaskDelay(pinDelay_2/ portTICK_PERIOD_MS);
    }
}

void readSerial(void *param)
{
    while (1)
    {
        if (Serial.available())
        {
            String s = Serial.readStringUntil('\n');
            Serial.println(s);
            pinDelay_1 = s.toInt();
            pinDelay_2 = pinDelay_1*3;
        }
    }
}

void setup()
{
    Serial.begin(115200);
    Serial.println("Esp ready for create tasks");
    pinMode(pin_1, OUTPUT);
    xTaskCreatePinnedToCore(
        togglePin,
        "pin toggles",
        1024,
        NULL,
        2,
        NULL,
        app_cpu);
    xTaskCreatePinnedToCore(
        toggle2Pin,
        "pin toggles2",
        1024,
        NULL,
        3,
        NULL,
        app_cpu);    
    Serial.println("pin toggles created");
    xTaskCreatePinnedToCore(
        readSerial,
        "serial",
        1024,
        NULL,
        1,
        NULL,
        app_cpu);
}

void loop() {}