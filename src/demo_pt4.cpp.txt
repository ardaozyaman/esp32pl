#include <Arduino.h>

#if CONFING_FREERTOS_UNICORE
static const BaseType_t app_core = 0;
#else
static const BaseType_t app_core = 1;
#endif


static const uint8_t msg_que_len = 5;

static QueueHandle_t msg_que;


void printMsg(void *params){
    int item;

    while (1)
    {
        if(xQueueReceive(msg_que,(void *)&item,0)==pdTRUE){
            Serial.println(item);
        }else{
            Serial.print("failed to recieve");
        }
        //Serial.println(item);
        vTaskDelay(50/portTICK_PERIOD_MS);
    }
    
}

void setup(){
    Serial.begin(115200);
    Serial.println();
    Serial.println("---FreeRTOS Queue Demo---");

    msg_que =xQueueCreate(msg_que_len,sizeof(int));

    xTaskCreatePinnedToCore(
        printMsg,
        "prints",
        1024,
        NULL,
        1,
        NULL,
        app_core
    );
}

void loop(){
    static int num = 0;

    if(xQueueSend(msg_que,(void *)&num,25)!=pdTRUE){
        Serial.println("your que is full.");
    }else{
        num++;        
    }
    

    vTaskDelay(25/portTICK_PERIOD_MS);
}